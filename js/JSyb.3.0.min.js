/* 夏仁南 v3.0 2021年5月3日 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},JSyb={id:function(n){return document.getElementById(n)},convert:function(n){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("object"===(void 0===n?"undefined":_typeof(n))){return Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")+"&_="+(new Date).getTime()}return alert("convert Object错误")},fetch:function(n){function t(t,r,e,o){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(n,t,r,e){if(4!==arguments.length)return alert("fetch 参数错误");var o,i=this.convert(r);"GET"===t&&(n+="?"+i,o={method:"GET",credentials:"include"}),"POST"===t&&(o={method:"POST",credentials:"include",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:i}),"FILE"===t&&(o={method:"POST",credentials:"include",body:r}),fetch(n,o).then(function(n){n.text().then(function(n){e(n)})})}),css:function(n){if(!n||0===n.length)return"CSS 文件不存在";var t=document.getElementsByTagName("head")[0],r=document.createElement("link");r.href=n,r.rel="stylesheet",r.type="text/css",t.appendChild(r)},js:function(n){if(!n||0===n.length)return"JS 文件不存在";var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.src=n,r.type="text/javascript",t.appendChild(r)},sm3:function(n){function t(n,t){var r=n.length;return Array(t>r?t-r+1:0).join(0)+n}function r(n){for(var r="",e=0;e<n.length/8;e+=1)r+=t(parseInt(n.substr(8*e,8),2).toString(16),2);return r}function e(n){for(var r="",e=0;e<n.length/2;e+=1)r+=t(parseInt(n.substr(2*e,2),16).toString(2),8);return r}function o(n){var r=[],e=n.codePointAt(0);e>=0&&e<=127?r.push(e):e>=128&&e<=2047?(r.push(192|31&e>>6),r.push(128|63&e)):e>=2048&&e<=55295||e>=57344&&e<=65535?(r.push(224|15&e>>12),r.push(128|63&e>>6),r.push(128|63&e)):e>=65536&&e<=1114111&&(r.push(240|7&e>>18),r.push(128|63&e>>12),r.push(128|63&e>>6),r.push(128|63&e));var o="",i=!0,u=!1,l=void 0;try{for(var a,s=r[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var h=a.value,c=h.toString(2);o+=t(c,8*Math.ceil(c.length/8))}}catch(n){u=!0,l=n}finally{try{!i&&s.return&&s.return()}finally{if(u)throw l}}return o}function i(n,t){return n.substring(t%n.length)+n.substr(0,t%n.length)}function u(n,t,r){for(var e=n||"",o=t||"",i=[],u=void 0,l=e.length-1;l>=0;l-=1)u=r(e[l],o[l],u),i[l]=u[0];return i.join("")}function l(n,t){return u(n,t,function(n,t){return[n===t?"0":"1"]})}function a(n,t){return u(n,t,function(n,t){return["1"===n&&"1"===t?"1":"0"]})}function s(n,t){return u(n,t,function(n,t){return["1"===n||"1"===t?"1":"0"]})}function h(n,t){return u(n,t,function(n,t,r){var e=r?r[1]:"0";return n!==t?["0"===e?"1":"0",e]:[e,n]})}function c(n){return u(n,void 0,function(n){return["1"===n?"0":"1"]})}function f(n){return function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];return r.reduce(function(t,r){return n(t,r)})}}function g(n){return f(l)(n,i(n,9),i(n,17))}function y(n){return f(l)(n,i(n,15),i(n,23))}function d(n,t,r,e){return e>=0&&e<=15?f(l)(n,t,r):f(s)(a(n,t),a(n,r),a(t,r))}function v(n,t,r,e){return e>=0&&e<=15?f(l)(n,t,r):s(a(n,t),a(c(n),r))}function p(n){return e(n>=0&&n<=15?"79cc4519":"7a879d8a")}var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,w=function(n){var t="",r=!0,e=!1,i=void 0;try{for(var u,l=n[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){t+=o(u.value)}}catch(n){e=!0,i=n}finally{try{!r&&l.return&&l.return()}finally{if(e)throw i}}return t}(n),A=w.length,m=A%512;m=m>=448?512-m%448-1:448-m-1;for(var S=(w+"1"+t("",m)+t(A.toString(2),64)).toString(),C=(A+m+65)/512,T=e("7380166f4914b2b9172442d7da8a0600a96f30bc163138aae38dee4db0fb0e4e"),_=0;_<=C-1;_+=1){var x=S.substr(512*_,512);T=function(n,t){for(var r=[],e=[],o=0;o<16;o+=1)r.push(t.substr(32*o,32));for(var u=16;u<68;u+=1)r.push(f(l)(y(f(l)(r[u-16],r[u-9],i(r[u-3],15))),i(r[u-13],7),r[u-6]));for(var a=0;a<64;a+=1)e.push(l(r[a],r[a+4]));for(var s=[],c=0;c<8;c+=1)s.push(n.substr(32*c,32));for(var b=s[0],w=s[1],A=s[2],m=s[3],S=s[4],C=s[5],T=s[6],_=s[7],x=void 0,B=void 0,k=void 0,j=void 0,E=0;E<64;E+=1)x=i(f(h)(i(b,12),S,i(p(E),E)),7),B=l(x,i(b,12)),k=f(h)(d(b,w,A,E),m,B,e[E]),j=f(h)(v(S,C,T,E),_,x,r[E]),m=A,A=i(w,9),w=b,b=k,_=T,T=i(C,19),C=S,S=g(j);return l(Array(b,w,A,m,S,C,T,_).join(""),n)}(T,x)}return 16===b?r(T).slice(0,16):32===b?r(T).slice(0,32):64===b?r(T):void 0},sm4:function(n,t,r){function e(){this.secretKey="1234567890abcdef",this.iv="",this.hexString=!1,this.decryptData_ECB=function(n){var t=l(n),r=this.stringToByte(this.secretKey),e=new o,u=e.decrypt_ecb(r,t);return i.bytesToUtf8Str(u)},this.encryptData_ECB=function(n){var t=this.stringToByte(n),r=this.stringToByte(this.secretKey);return u((new o).encrypt_ecb(r,t))},this.decryptData_CBC=function(n){var t=l(n),r=this.stringToByte(this.secretKey),e=this.stringToByte(this.iv),u=new o,a=u.decrypt_cbc(r,e,t);return i.bytesToUtf8Str(a)},this.encryptData_CBC=function(n){var t=this.stringToByte(n),r=this.stringToByte(this.secretKey),e=this.stringToByte(this.iv);return u((new o).encrypt_cbc(r,e,t))},this.stringToByte=function(n){var t,r,e=new Array;t=n.length;for(var o=0;o<t;o++)r=n.charCodeAt(o),r>=65536&&r<=1114111?(e.push(r>>18&7|240),e.push(r>>12&63|128),e.push(r>>6&63|128),e.push(63&r|128)):r>=2048&&r<=65535?(e.push(r>>12&15|224),e.push(r>>6&63|128),e.push(63&r|128)):r>=128&&r<=2047?(e.push(r>>6&31|192),e.push(63&r|128)):e.push(255&r);return e}}function o(){this.sbox=new Array(214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,32,121,238,95,62,215,203,57,72),this.fk=new Array(2746333894,1453994832,1736282519,2993693404),this.ck=new Array(462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257)}function i(){}function u(n){for(var t=[],r=0;r<n.length;r++)t.push((n[r]>>>4).toString(16)),t.push((15&n[r]).toString(16));return t.join("")}function l(n){for(var t=[],r=0;r<n.length;r+=2)t.push(parseInt(n.substr(r,2),16));return t}function a(n,t,r,e,o){var i=o;i=t+o>n.length&&e+o<=r.length?n.length-t:e+o>r.length&&t+o<=n.length?r.length-e:t+o<=n.length&&e+o<=r.length?o:r.length<n.length?r.length-e:n.length-e;for(var u=0;u<i;u++)r[u+e]=n[u+t]}function s(n){return new Array(n>>24&255,n>>16&255,n>>8&255,255&n)}function h(n){for(var t=new Array(4*n.length),r=0;r<n.length;r++)a(s(n[r]),0,t,4*r,4);return t}function c(n,t){return t+3<n.length?n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]:t+2<n.length?n[t+1]<<16|n[t+2]<<8|n[t+3]:t+1<n.length?n[t]<<8|n[t+1]:n[t]}function f(n){for(var t=Math.ceil(n.length/4),r=new Array(t),e=0;e<n.length;e++)n[e]=255&n[e];for(var e=0;e<r.length;e++)r[e]=c(n,4*e);return r}o.prototype={expandKey:function(n){var t=new Array(36),r=f(n);t[0]=r[0]^this.fk[0],t[1]=r[1]^this.fk[1],t[2]=r[2]^this.fk[2],t[3]=r[3]^this.fk[3];for(var e=new Array(32),o=0;o<32;o++)t[o+4]=t[o]^this.T1(t[o+1]^t[o+2]^t[o+3]^this.ck[o]),e[o]=t[o+4];return e},T1:function(n){var t=new Array(4),r=s(n);t[0]=this.sbox[255&r[0]],t[1]=this.sbox[255&r[1]],t[2]=this.sbox[255&r[2]],t[3]=this.sbox[255&r[3]];var e=c(t,0);return e^(e<<13|e>>>19)^(e<<23|e>>>9)},one_encrypt:function(n,t){var r=new Array(36);r[0]=c(t,0),r[1]=c(t,4),r[2]=c(t,8),r[3]=c(t,12);for(var e=0;e<32;e++)r[e+4]=r[e]^this.T0(r[e+1]^r[e+2]^r[e+3]^n[e]);for(var o=new Array(4),e=35;e>=32;e--)o[35-e]=r[e];return h(o)},T0:function(n){var t=s(n),r=new Array(4);r[0]=this.sbox[255&t[0]],r[1]=this.sbox[255&t[1]],r[2]=this.sbox[255&t[2]],r[3]=this.sbox[255&t[3]];var e=c(r,0);return e^(e<<2|e>>>30)^(e<<10|e>>>22)^(e<<18|e>>>14)^(e<<24|e>>>8)},pkcs7padding:function(n,t){if(null==n)return null;var r=null;if(1==t){var e=16-n.length%16;r=new Array(n.length+e),a(n,0,r,0,n.length);for(var o=0;o<e;o++)r[n.length+o]=e}else{var e=n[n.length-1];r=new Array(n.length-e),a(n,0,r,0,n.length-e)}return r},encrypt_ecb:function(n,t){if(void 0==n||null==n||n.length%16!=0)return console.log("sm4 key is error!"),null;if(void 0==t||null==t||t.length<=0)return console.log("data is error!"),null;for(var r=this.expandKey(n),e=parseInt(t.length/16),o=new Array(16*(e+1)),i=new Array(16),u=null,l=0;l<e;l++)a(t,16*l,i,0,16),u=this.one_encrypt(r,i),a(u,0,o,16*l,16);var s=new Array(t.length%16);s.length>0&&a(t,16*e,s,0,t.length%16);var h=this.pkcs7padding(s,1);return u=this.one_encrypt(r,h),a(u,0,o,16*e,16),o},decrypt_ecb:function(n,t){if(void 0==n||null==n||n.length%16!=0)return console.log("sm4 key is error!"),null;if(void 0==t||null==t||t.length%16!=0)return console.log("data is error!"),null;for(var r=this.expandKey(n),e=new Array(32),o=0;o<r.length;o++)e[o]=r[32-o-1];var i=t.length/16-1,u=new Array(16),l=null,s=null;a(t,16*i,u,0,16),l=this.one_encrypt(e,u);var h=this.pkcs7padding(l,0);s=new Array(16*i+h.length),a(h,0,s,16*i,h.length);for(var o=0;o<i;o++)a(t,16*o,u,0,16),l=this.one_encrypt(e,u),a(l,0,s,16*o,16);return s},encrypt_cbc:function(n,t,r){if(void 0==n||null==n||n.length%16!=0)return console.log("sm4 key is error!"),null;if(void 0==r||null==r||r.length<=0)return console.log("data is error!"),null;if(void 0==t||null==t||t.length%16!=0)return console.log("iv is error!"),null;for(var e=this.expandKey(n),o=parseInt(r.length/16),i=new Array(16*(o+1)),u=new Array(16),l=0;l<o;l++){a(r,16*l,u,0,16);for(var s=0;s<16;s++)u[s]=u[s]^t[s];t=this.one_encrypt(e,u),a(t,0,i,16*l,16)}var h=new Array(r.length%16);h.length>0&&a(r,16*o,h,0,r.length%16);for(var c=this.pkcs7padding(h,1),l=0;l<16;l++)c[l]=c[l]^t[l];return t=this.one_encrypt(e,c),a(t,0,i,16*o,16),i},decrypt_cbc:function(n,t,r){if(void 0==n||null==n||n.length%16!=0)return console.log("sm4 key is error!"),null;if(void 0==r||null==r||r.length%16!=0)return console.log("data is error!"),null;if(void 0==t||null==t||t.length%16!=0)return console.log("iv is error!"),null;for(var e=this.expandKey(n),o=new Array(32),i=0;i<e.length;i++)o[i]=e[32-i-1];var u=r.length/16,l=new Array(16),s=null,h=null;h=new Array(r.length);for(var i=0;i<u;i++){a(r,16*i,l,0,16),s=this.one_encrypt(o,l);for(var c=0;c<16;c++)s[c]=s[c]^t[c];a(l,0,t,0,16),a(s,0,h,16*i,16)}var f=this.pkcs7padding(s,0),g=new Array(h.length-16+f.length);return a(h,0,g,0,h.length-16),a(f,0,g,h.length-16,f.length),g}},i.encode=function(n,t,r){for(var e=new Array(2*r),o=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"),i=t,u=0;i<r+t;i++,u++)e[u]=o[(255&n[i])>>4],e[++u]=o[15&n[i]];return e.join("")},i.decode=function(n){if(null==n||""==n)return null;if(n.length%2!=0)return null;for(var t=n.length/2,r=this.toCharCodeArray(n),e=new Array(t),o=0;o<t;o++){if(r[2*o]>=48&&r[2*o]<=57)e[o]=r[2*o]-48<<4;else if(r[2*o]>=65&&r[2*o]<=70)e[o]=r[2*o]-65+10<<4;else{if(!(r[2*o]>=97&&r[2*o]<=102))return null;e[o]=r[2*o]-97+10<<4}if(r[2*o+1]>=48&&r[2*o+1]<=57)e[o]=e[o]|r[2*o+1]-48;else if(r[2*o+1]>=65&&r[2*o+1]<=70)e[o]=e[o]|r[2*o+1]-65+10;else{if(!(r[2*o+1]>=97&&r[2*o+1]<=102))return null;e[o]=e[o]|r[2*o+1]-97+10}}return e},i.utf8StrToHex=function(n){for(var t=encodeURIComponent(n),r=unescape(t),e=r.length,o=[],i=0;i<e;i++)o[i]=r.charCodeAt(i).toString(16);return o.join("")},i.utf8StrToBytes=function(n){for(var t=encodeURIComponent(n),r=unescape(t),e=r.length,o=[],i=0;i<e;i++)o[i]=r.charCodeAt(i);return o},i.hexToUtf8Str=function(n){for(var t=i.decode(n),r=[],e=0;e<t.length;e++)r.push(String.fromCharCode(t[e]));return decodeURIComponent(escape(r.join("")))},i.bytesToUtf8Str=function(n){for(var t=n,r=[],e=0;e<t.length;e++)r.push(String.fromCharCode(t[e]));return decodeURIComponent(escape(r.join("")))},i.toCharCodeArray=function(n){for(var t=new Array(n.length),r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t};var g=new e;return g.secretKey=this.sm3(t,16),"en"===n?g.encryptData_ECB(r):"de"===n?g.decryptData_ECB(r):void 0}};
